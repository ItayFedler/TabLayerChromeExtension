var dt,newTabid=-9,arraytabs,currentTabId,blacklistedUrls=[];chrome.storage.local.get({domains:blacklistedUrls},function(a){blacklistedUrls=a.domains});
chrome.tabs.onActivated.addListener(function(a){chrome.tabs.get(a.tabId,function(a){var c=blacklistedUrls.filter(function(b){return b.domain==extractHostname(a.url)});currentTabId=a.id;chrome.tabs.captureVisibleTab(null,{},function(b){dt=new Date;var d=arraytabs.filter(function(b){return b.id==a.id});0!=d.length&&(d[0].last_seen=dt.getTime(),d[0].image_2=b||"./placeholder-image.png",0<c.length&&(d[0].image_2="./placeholder-image-100.png"),arraytabs=arraytabs.filter(function(b){return b.id!=a.id}),
arraytabs.push(d[0]),updateStorage())})})});chrome.tabs.query({},function(a){arraytabs=[];dt=new Date;a.forEach(function(a){addTabToArray(a)});updateStorage()});function addTabToArray(a){var c="./placeholder-image.png";0<blacklistedUrls.filter(function(c){return c.domain==extractHostname(a.url)}).length&&(c="./placeholder-image-100.png");arraytabs.push({winId:a.windowId,id:a.id,title:a.title,group:a.url,image_2:c,image_1:a.favIconUrl,last_seen:dt.getTime(),index:-a.index})}chrome.tabs.onRemoved.addListener(function(a){removeItem(a)});
chrome.tabs.onCreated.addListener(function(a){dt=new Date;newTabid=a.id;var c="./placeholder-image.png";0<blacklistedUrls.filter(function(c){return c.domain==extractHostname(a.url)}).length&&(c="./placeholder-image-100.png");arraytabs.push({winId:a.windowId,id:a.id,title:a.title,group:a.url,image_2:c,image_1:a.favIconUrl,last_seen:dt.getTime(),index:-a.index});updateStorage()});
chrome.tabs.onUpdated.addListener(function(a,c,e){console.log(c);var b=arraytabs.filter(function(b){return b.id==a});if("string"===typeof c.status){var d=blacklistedUrls.filter(function(a){return a.domain==extractHostname(e.url)});if(0!=b.length){b[0].image_1=e.favIconUrl;b[0].image_2="./placeholder-image.png";0<d.length&&(b[0].image_2="./placeholder-image-100.png");b[0].group=e.url;b[0].title=e.title;0===d.length&&"complete"==c.status&&currentTabId===a&&chrome.tabs.captureVisibleTab(null,{quality:0},
function(c){void 0!==c&&(b[0].image_2=c,arraytabs=arraytabs.filter(function(b){return b.id!=a}),arraytabs.push(b[0]),updateStorage())});arraytabs=arraytabs.filter(function(b){return b.id!=a});arraytabs.push(b[0]);updateStorage();return}}"string"===typeof c.title&&(b[0].title=e.title,d=blacklistedUrls.filter(function(a){return a.domain==extractHostname(e.url)}),0<d.length?b[0].image_2="./placeholder-image-100.png":currentTabId===a&&chrome.tabs.captureVisibleTab(null,{quality:0},function(c){void 0!==
c&&(b[0].image_2=c,arraytabs=arraytabs.filter(function(b){return b.id!=a}),arraytabs.push(b[0]),updateStorage())}),arraytabs=arraytabs.filter(function(b){return b.id!=a}),arraytabs.push(b[0]),updateStorage())});
chrome.runtime.onMessage.addListener(function(a,c,e){"removed"===a.message&&(chrome.tabs.remove(parseInt(a.tabid),function(){}),removeItem(a.tabid));"toggleBlacklisted"===a.message&&(0===blacklistedUrls.filter(function(b){return b.domain==a.domain}).length?blacklistedUrls.push({domain:a.domain}):blacklistedUrls=blacklistedUrls.filter(function(b){return b.domain!=a.domain}),updateBlacklistStorage());"capture"===a.message&&chrome.tabs.captureVisibleTab(null,{},function(a){var b=arraytabs.filter(function(a){return a.id==
curr});0!=b.length&&(b[0].image_2=a,arraytabs=arraytabs.filter(function(a){return a.id!=tabId}),arraytabs.push(b[0]),updateStorage())})});function removeItem(a){arraytabs=arraytabs.filter(function(c){return c.id!=a});updateStorage()}function updateStorage(){console.log(arraytabs);chrome.storage.local.set({tabjson:arraytabs},function(){})}function updateBlacklistStorage(){chrome.storage.local.set({domains:blacklistedUrls},function(){})}setInterval(function(){},1E4);
function extractHostname(a){a=-1<a.indexOf("//")?a.split("/")[2]:a.split("/")[0];a=a.split(":")[0];return a=a.split("?")[0]};